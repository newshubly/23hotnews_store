<!-- MVP.css quickstart template: https://github.com/andybrewer/mvp/ -->

<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="https://via.placeholder.com/70x70">
    <link rel="stylesheet" href="https://andybrewer.github.io/mvp/mvp.css">
    <link rel="stylesheet" href="main.css">
    <meta charset="utf-8">
    <meta name="description" content="Hotnews">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <title>Hotnews</title>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li><a href="list.html">Home</a></li>
                <li><a href="#section-1">News</a></li>
                <li><a href="#">TodayNews</a>
                    <ul id="todaylist">
                    </ul>
                </li>
            </ul>
        </nav>
        <!-- <section id="sidebar"></section> -->
        <!-- <h2>Section Heading</h2> -->
        <!-- <p>Section Subheading</p> -->
    </header>
    <main>

        <section id="section-1">
            <!-- <aside>
                <h3>Card heading</h3>
                <p>Card content <sup>with notification</sup></p>
            </aside>
            <aside>
                <h3>Card heading</h3>
                <p>Card content</p>
            </aside>
            <aside>
                <h3>Card heading</h3>
                <p>Card content</p>
            </aside>
            <aside>
                <h3>Card heading</h3>
                <p>Card content</p>
            </aside> -->
        </section>
        <button type="button" class="btn btn-info ui-btn-top">
            <span class="glyphicon glyphicon-arrow-up"></span>↑
        </button>
        <button type="button" class="btn btn-info ui-btn-end">
            <span class="glyphicon glyphicon-arrow-up"></span>↓
        </button>
    </main>
    <footer>
        <!-- <hr>
        <p>
            <small>Contact info</small>
        </p> -->
    </footer>
    <script type="text/javascript">
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        };
        (function () {
            var date = new Date();
            date.setMinutes(date.getMinutes() - 66);
            var current_d = dateToYMD(date).slice(-11);
            console.log("current", current_d);
            if (getUrlParameter('d')) {
                var queryd = getUrlParameter('d');
                var url = geturl(queryd.slice(0, 4) + '/' + queryd.slice(4, 6) + '/' + queryd.slice(6, 8) + '/' + queryd);
            } else {
                var queryd = dateToYMD(date).slice(-11);
                var url = geturl(dateToYMD(date));
            }
            // var url = geturl(dateToYMD(date));
            console.log(url);
            console.log(queryd);
            genTodayListToSidebar(current_d);
            $.get(url, function (data, status) {
                var news_list = data.split('\n').map(JSON.parse);
                // console.log(news_list);
                news_list.forEach(function (item, i) {
                    var card = "<aside><h3><a href='" + item.link + "' target='_blank'>" + item.title + "</a></h3>";
                    // <p>" + item.summary + "</p>"
                    // + "<p>" + item.published_my + "</p>" +
                    // +"<small><p>" + item.label + "</small></p>" +
                    // + "</aside>";

                    if (isNaN(item.summary)) {
                        card += "<p>" + item.summary + "</p>";
                    }
                    card += "<div class='info'>";
                    if (isNaN(item.published_my)) {
                        card += "<p class='published_my'>" + item.published_my + "</p>";
                    }
                    if (isNaN(item.label)) {
                        card += "<small><p class='label'>" + item.label + "</small></p>";
                    }
                    if (isNaN(item.site)) {
                        if (item.site != item.label) {
                            card += "<small><p class='site'>" + item.site + "</small></p>";
                        }
                    }
                    card += "</div>";
                    // console.log(i);
                    // console.log(typeof(item))
                    // console.log(item);
                    $('#section-1').append(card);
                })
                // $(".result").html(data);
                // $("#hotterm-preview").html(marked(data));
                // toc();
                // $("#category").prepend('<h3>Hot Term(' + date + ')</h2>');
                //alert(status);
                //alert( "Load was performed." );
                window.history.pushState(queryd, null, window.location.pathname + "?" + $.param({ 'd': queryd }));
                document.title = "Hot Term " + queryd;
            }).fail(function () {
                alert('zzz' + status);
            });
        })();


        function toc() {
            $("h2,h3,h4,h5,h6").each(function (i, item) {
                var tag = $(item).get(0).localName;
                $(item).attr("id", "wow" + i);
                $("#category").append('<a class="new' + tag + '" href="#wow' + i + '">' + $(this).text() + '</a></br>');
                $(".newh2").css("margin-left", 0);
                $(".newh3").css("margin-left", 20);
                $(".newh4").css("margin-left", 40);
                $(".newh5").css("margin-left", 60);
                $(".newh6").css("margin-left", 80);
            });
        }
        function dateToYMD(date) {
            var d = date.getDate();
            var m = date.getMonth() + 1; //Month from 0 to 11
            var y = date.getFullYear();
            var h = date.getHours();
            m = (m <= 9 ? '0' + m : m);
            d = (d <= 9 ? '0' + d : d);
            h = (h <= 9 ? '0' + h : h);
            return y + '/' + m + '/' + d + '/' + y + m + '' + d + '_' + h;
        }
        function geturl(d) {
            https://raw.githubusercontent.com/newshubly/23hotnews_store/master/json/2023/09/05/20230905_18_hotnews.json
            var url_prefix = "https://raw.githubusercontent.com/newshubly/23hotnews_store/master/json/";
            return url_prefix + d + '_hotnews.json'
        }
        $(document).ready(function () {
            $(document).on('click', '.ui-btn-top', function (evt) {
                evt.preventDefault();
                $('html, body').animate({ scrollTop: 0 }, 300); //http://api.jquery.com/animate/
            });
        });
        $(document).ready(function () {
            $(document).on('click', '.ui-btn-end', function (evt) {
                evt.preventDefault();
                $('html, body').animate({ scrollTop: $(document).height() }, 300); //http://api.jquery.com/animate/
            });
        });
        function genTodayListToSidebar(queryd) {
            // $('#sidebar').append("<details id='todaylist'><summary>本日熱門</summary></details>");
            var todaydiv = $("#todaylist");
            //20181012_01
            for (i = 0; i < 24; i++) {
                var d = queryd.slice(0, 8) + "_" + (i < 10 ? "0" + i : i);
                var link = window.location.pathname + "?d=" + d;
                var text = queryd.slice(0, 4) + '-' + queryd.slice(4, 6) + '-' + queryd.slice(6, 8) + " " + (i < 10 ? "0" + i : i);
                // todaydiv.append("<p><a href='" + link + "'>" + text + "</p>");
                todaydiv.append("<li><a href='" + link + "'>" + text + "</a></li>");
                if (queryd == d) {
                    break
                }
            }
            // $('#sidebar').append(todaydiv);

        }
    </script>
</body>

</html>
